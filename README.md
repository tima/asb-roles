# ASB-enabled Roles

An Ansible-native alternative to APBs using standard roles and playbooks with few extra requirements or special tooling.

ASB-enabled Roles are standard Ansible roles that can be created from scratch for use with the ASB or easily ported from existing Ansible roles including those generated by ansible-container.

### How are ESB-roles different from standard roles

* Adds a `asb.yml` file in the role's `meta/` directory -- this is the `apb.yml` metafile the APB format uses. Being in `meta/`, this file would be ignored by standard Ansible and Ansible Tower without side effects. (Currently this file does nothing in the context of this strawman -- it exists to show how ASB metadata could be stored in the Ansible role format.) 
* Each role would have multiple task files that correspond to each service broker action it implements. See the "Mapping vs. Naming Standards" point under "Further Consideration" below.
* The service broker would use a single (ideally dynamically generated) Ansible playbook such as `/asb.yml` that would call the role, passing in the action (thru a variable called `asb_action` in the example) it is to perform. 

### Pros:

* Ansible users already know it
* New overlapping format is not required
* Easy to port existing and generate roles for use with the ASB

### Cons:

* https://github.com/ansible/ansible/issues/22571 forces a workaround with the latest stable version of v2.3. This issue should get fixed rather then use such a hack.
* Doesn't (currently) address use of the Dockerfile shell script.

### Testing

```
ansible-playbook asb.yml -e "asb_action=provision"
ansible-playbook asb.yml -e "asb_action=deprovision"
ansible-playbook asb.yml -e "asb_action=bind"
ansible-playbook asb.yml -e "asb_action=unbind"
```

NOTE: `main.yml` errors out because of the issue mentioned under "Cons" above. 

### Further Consideration

* Replace `Dockerfile` used by APB format with an Ansible play or task file.
* Mapping vs Naming Conventions. ASB-enabled Roles could force a standard naming conventions like `provision.yml` or provide an action to task filename mapping table function. To support both existing Ansible roles and making it easier to develop ones expressly created for the ASB, both should probably be supported -- looking for a mapping and if none is found default to the naming standard. The `tasks/apb.yml` workaround could be implemented as mapping function, however other implementation such as a data structure in the `meta/asb.yml` file may be more elegant.
